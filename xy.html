<!DOCTYPE html>
<html>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <head>
    <title>国池酒AR互动</title>

    <script src="js/aframe.min.js"></script>
    <script src="js/aframe-extras.min.js"></script>
    <!-- <script src="https://raw.githack.com/jeromeetienne/AR.js/2.0.8/aframe/build/aframe-ar.js"></script> -->
    <style>h1 {text-align: center; color: blue;}</style>
    <!-- Create Video Feed Background using https://glitch.com/edit/#!/stack-57493298?path=index.html%3A15%3A0 -->
    <style>   
      #webcam {
          opacity:1;
          position: fixed;
          background-size: 100% 100%;
          top: 0; left: 0; 
          min-width: 100%; min-height: 100%;
          width: auto; height: auto;
          z-index: -1;
      }
    </style>
    <script>
      var cameraView;
      var ua = window.navigator.userAgent.toLowerCase(); // for Wechat detection
      var constraints = {
          audio: false,
          video: {
              facingMode: "environment",
          }
      };

      // Access the device camera and stream to cameraView
      function cameraStart() {
          
          // Detect if Wechat
          if (ua.match(/MicroMessenger/i) == 'micromessenger') {
              alert("微信暂不支持AR\n请用原生浏览器（如Safari）打开页面并允许使用设备相机");
          }

          cameraView = document.querySelector("#webcam");
          navigator.mediaDevices
              .getUserMedia(constraints)
              .then(function(stream) {
              cameraView.srcObject = stream;
          })
          .catch(function(error) {
              // console.error("Oops. Something is broken.", error);
              alert("当前浏览器不支持AR\n请用原生浏览器（如Safari）打开页面并允许使用设备相机");
          });
          
      }
  
          // Start the video stream when the window loads
          window.addEventListener("load", cameraStart, false);
  
          // Component to change to a sequential color on cursor suspension.
          AFRAME.registerComponent('cursor-listener', {
            init: function () {
              var lastIndex = -1;
              var COLORS = ['red', 'green', 'blue'];
              this.el.addEventListener('click', function (evt) {
                lastIndex = (lastIndex + 1) % COLORS.length;
                this.setAttribute('material', 'color', COLORS[lastIndex]);
                console.log('I was clicked at: ', evt.detail.intersection.point);
              });
            }
          });
      </script>


  </head>
  <body>
    <h1>测试页面</h1>
    <video id="webcam" autoplay playsinline></video>
    <a-scene renderer="antialias: true; colorManagement: true;" 
             loading-screen="dotsColor: #e2e2dc; backgroundColor: #e2e2e2" 
             vr-mode-ui="enabled: false"
             > 
      <a-assets>
        <a-asset-item id="model" src="assets/xiang_yu/scene.gltf"></a-asset-item>
      </a-assets>
      
      <a-entity camera position="0 1.5 0"></a-entity>
      <a-entity id="mouseCursor" cursor="rayOrigin: mouse"></a-entity>
      <a-entity light="color: #eee; intensity: 1" position="0 1 2"></a-entity>
      <a-entity light="type: ambient; color: #eee; intensity: 1"></a-entity>

      <a-entity gltf-model="#model" scale="15 15 15" position="0 0 -2.5" rotation="0 0 0" animation-mixer></a-entity>
    </a-scene>
  </body>
</html>